<invoke name="artifacts">
<parameter name="command">rewrite</parameter>
<parameter name="type">text/html</parameter>
<parameter name="id">nutri-track-complet</parameter>
<parameter name="title">Nutri-Track Saison Auto - Hocine</parameter>
<parameter name="content"><!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Nutri-Track Hocine</title>
    <style>
        * {margin: 0; padding: 0; box-sizing: border-box;}
        body {font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Arial, sans-serif; background: linear-gradient(135deg, #51cf66 0%, #37b24d 100%); min-height: 100vh; padding: 15px; color: #333;}
        .container {max-width: 900px; margin: 0 auto; background: white; border-radius: 20px; padding: 20px; box-shadow: 0 20px 60px rgba(0,0,0,0.3);}
        h1 {text-align: center; color: #51cf66; margin-bottom: 5px; font-size: 26px;}
        .version-badge {text-align: center; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 4px 12px; border-radius: 20px; font-size: 11px; font-weight: bold; display: inline-block; margin-bottom: 10px;}
        .season-badge {text-align: center; background: linear-gradient(135deg, #ff6b6b 0%, #ff8787 100%); color: white; padding: 6px 16px; border-radius: 20px; font-size: 12px; font-weight: bold; display: inline-block; margin: 10px 5px;}
        .header-info {text-align: center; color: #666; margin-bottom: 15px; font-size: 13px;}
        .day-tracker {background: linear-gradient(135deg, #51cf66 0%, #37b24d 100%); color: white; padding: 15px; border-radius: 15px; margin-bottom: 15px; text-align: center;}
        .day-display {font-size: 32px; font-weight: bold; margin: 10px 0;}
        .day-controls {display: flex; gap: 8px; justify-content: center; margin-top: 10px;}
        .auto-save-indicator {position: fixed; top: 20px; right: 20px; background: #51cf66; color: white; padding: 8px 16px; border-radius: 20px; font-size: 12px; font-weight: bold; opacity: 0; transition: opacity 0.3s; z-index: 1000; box-shadow: 0 4px 12px rgba(0,0,0,0.2);}
        .auto-save-indicator.show {opacity: 1;}
        .tabs {display: grid; grid-template-columns: repeat(auto-fit, minmax(100px, 1fr)); gap: 8px; margin-bottom: 20px;}
        .tab {padding: 12px 8px; background: #f0f0f0; border: none; border-radius: 10px; cursor: pointer; font-weight: bold; transition: all 0.3s; font-size: 13px;}
        .tab.active {background: linear-gradient(135deg, #51cf66 0%, #37b24d 100%); color: white; transform: translateY(-2px); box-shadow: 0 4px 12px rgba(81, 207, 102, 0.4);}
        .tab-content {display: none;}
        .tab-content.active {display: block; animation: fadeIn 0.4s;}
        @keyframes fadeIn {from {opacity: 0; transform: translateY(10px);} to {opacity: 1; transform: translateY(0);}}
        .nutrition-section {background: #f0fff4; border-radius: 15px; padding: 15px; margin-bottom: 15px; border-left: 5px solid #51cf66;}
        .nutrition-section h3 {color: #51cf66; margin-bottom: 12px; font-size: 18px;}
        .meal {background: white; padding: 12px; margin: 10px 0; border-radius: 10px; box-shadow: 0 2px 8px rgba(0,0,0,0.1);}
        .meal-header {display: flex; justify-content: space-between; align-items: center; margin-bottom: 8px;}
        .meal-title {font-weight: bold; color: #333; font-size: 15px;}
        .meal-time {background: #51cf66; color: white; padding: 4px 12px; border-radius: 6px; font-size: 12px; font-weight: bold;}
        .meal-details {display: grid; grid-template-columns: repeat(auto-fit, minmax(100px, 1fr)); gap: 6px; margin: 8px 0; font-size: 12px;}
        .detail-item {background: #f0f0f0; padding: 5px 8px; border-radius: 6px;}
        .detail-label {font-weight: bold; color: #51cf66;}
        .meal-foods {background: #f9fafb; border-radius: 8px; padding: 10px; margin: 10px 0; font-size: 13px; line-height: 1.6;}
        .meal-foods ul {margin-left: 20px;}
        .season-tag {background: #fff9e6; color: #ff6b00; padding: 2px 8px; border-radius: 4px; font-size: 11px; font-weight: bold; margin-left: 5px;}
        .validation-checkbox {display: flex; align-items: center; gap: 10px; background: #e8f5e9; padding: 10px; border-radius: 8px; margin-top: 10px; cursor: pointer;}
        .validation-checkbox input {width: 20px; height: 20px; cursor: pointer;}
        .validation-checkbox.validated {background: #c8e6c9;}
        .progress-card {background: white; padding: 15px; border-radius: 10px; margin: 10px 0; box-shadow: 0 2px 8px rgba(0,0,0,0.1);}
        .progress-bar-container {background: #e0e0e0; border-radius: 10px; height: 30px; margin: 10px 0; overflow: hidden;}
        .progress-bar {background: linear-gradient(135deg, #51cf66 0%, #37b24d 100%); height: 100%; transition: width 0.5s; display: flex; align-items: center; justify-content: center; color: white; font-weight: bold; font-size: 14px;}
        .macro-grid {display: grid; grid-template-columns: repeat(auto-fit, minmax(120px, 1fr)); gap: 10px; margin: 15px 0;}
        .macro-card {background: linear-gradient(135deg, #f0f0f0 0%, #e0e0e0 100%); padding: 15px; border-radius: 10px; text-align: center;}
        .macro-card.calories {background: linear-gradient(135deg, #ffd93d 0%, #ff9800 100%); color: white;}
        .macro-card.proteines {background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white;}
        .macro-card.glucides {background: linear-gradient(135deg, #ffa500 0%, #ff6347 100%); color: white;}
        .macro-card.lipides {background: linear-gradient(135deg, #51cf66 0%, #37b24d 100%); color: white;}
        .macro-value {font-size: 28px; font-weight: bold; margin: 5px 0;}
        .macro-label {font-size: 11px; opacity: 0.9; text-transform: uppercase;}
        .grignotage-section {background: #fff9e6; border-left: 5px solid #ffc107; padding: 15px; border-radius: 15px; margin: 15px 0;}
        .grignotage-item {background: white; padding: 10px; margin: 8px 0; border-radius: 8px; display: flex; justify-content: space-between; align-items: center;}
        .btn {padding: 10px 16px; border: none; border-radius: 8px; font-weight: bold; cursor: pointer; transition: all 0.3s; font-size: 13px;}
        .btn-primary {background: linear-gradient(135deg, #51cf66 0%, #37b24d 100%); color: white;}
        .btn-primary:hover {transform: scale(1.05);}
        .btn-secondary {background: rgba(255,255,255,0.2); color: white; border: 2px solid white;}
        .btn-danger {background: #ff6b6b; color: white;}
        .modal {display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.7); z-index: 2000; justify-content: center; align-items: center;}
        .modal.show {display: flex;}
        .modal-content {background: white; padding: 30px; border-radius: 20px; max-width: 400px; width: 90%; animation: modalPop 0.3s;}
        @keyframes modalPop {from {transform: scale(0.8); opacity: 0;} to {transform: scale(1); opacity: 1;}}
        .modal-header {font-size: 22px; font-weight: bold; color: #51cf66; margin-bottom: 15px; text-align: center;}
        .modal-body {margin: 15px 0;}
        .modal-input {width: 100%; padding: 10px; border: 2px solid #e0e0e0; border-radius: 8px; margin: 8px 0; font-size: 14px;}
        .notes-area {width: 100%; min-height: 80px; padding: 10px; border: 2px solid #e0e0e0; border-radius: 8px; font-family: inherit; font-size: 13px; margin-top: 10px;}
        .info-box {background: #e3f2fd; border-left: 4px solid #2196f3; padding: 12px; border-radius: 8px; margin: 10px 0; font-size: 13px;}
        @media (max-width: 600px) {.container {padding: 12px;} h1 {font-size: 22px;} .macro-grid {grid-template-columns: repeat(2, 1fr);}}
    </style>
</head>
<body>
    <div class="auto-save-indicator" id="auto-save-indicator">‚úÖ Sauvegard√©</div>
    <div class="container">
        <h1>üçΩÔ∏è NUTRI-TRACK</h1>
        <div style="text-align: center;">
            <span class="version-badge">v2.0 ‚Ä¢ Saison Auto ‚Ä¢ Hocine 44 ans</span>
            <span class="season-badge" id="season-badge">üçÇ AUTOMNE</span>
        </div>
        <div class="header-info">Plan nutrition adapt√© ‚Ä¢ Cholest√©rol ‚Ä¢ Pr√©diab√®te ‚Ä¢ Muscu</div>
        <div class="day-tracker">
            <div style="font-size: 14px; margin-bottom: 5px;">üìÖ AUJOURD'HUI</div>
            <div class="day-display" id="day-display">üèãÔ∏è JOUR TRAINING</div>
            <div class="day-controls">
                <button class="btn btn-secondary" onclick="setDayType('training')">üèãÔ∏è Training</button>
                <button class="btn btn-secondary" onclick="setDayType('repos')">üí§ Repos</button>
            </div>
        </div>
        <div class="tabs">
            <button class="tab active" onclick="showTab('menu')">üìã MENU</button>
            <button class="tab" onclick="showTab('saison')">üçÇ SAISON</button>
            <button class="tab" onclick="showTab('progression')">üìä PROGR.</button>
            <button class="tab" onclick="showTab('grignotages')">üç™ SNACKS</button>
            <button class="tab" onclick="showTab('export')">üì§ EXPORT</button>
        </div>
        <div id="tab-menu" class="tab-content active">
            <div class="progress-card">
                <h3 style="color: #51cf66; margin-bottom: 10px;">üìä Progression du jour</h3>
                <div class="progress-bar-container"><div class="progress-bar" id="progress-bar" style="width: 0%">0%</div></div>
                <div class="macro-grid">
                    <div class="macro-card calories"><div class="macro-label">Calories</div><div class="macro-value"><span id="cal-actuel">0</span>/<span id="cal-total">2480</span></div></div>
                    <div class="macro-card proteines"><div class="macro-label">Prot√©ines</div><div class="macro-value"><span id="prot-actuel">0</span>/<span id="prot-total">208</span>g</div></div>
                    <div class="macro-card glucides"><div class="macro-label">Glucides</div><div class="macro-value"><span id="gluc-actuel">0</span>/<span id="gluc-total">264</span>g</div></div>
                    <div class="macro-card lipides"><div class="macro-label">Lipides</div><div class="macro-value"><span id="lip-actuel">0</span>/<span id="lip-total">90</span>g</div></div>
                </div>
            </div>
            <div id="menu-container"></div>
            <textarea class="notes-area" id="notes-jour" placeholder="üìù Notes du jour (√©nergie, sensations, gaz...)" oninput="showAutoSave()"></textarea>
        </div>
        <div id="tab-saison" class="tab-content">
            <h2 style="color: #51cf66; margin-bottom: 15px;">üçÇ Fruits & L√©gumes de Saison</h2>
            <div class="info-box">
                <strong>üìÖ Saison actuelle :</strong> <span id="season-name-detail">Automne</span> (mise √† jour automatique)
            </div>
            <div class="progress-card">
                <h3>üçé Fruits disponibles</h3>
                <div id="fruits-saison" style="display: flex; flex-wrap: wrap; gap: 8px; margin-top: 10px;"></div>
            </div>
            <div class="progress-card">
                <h3>ü•¶ L√©gumes disponibles</h3>
                <div id="legumes-saison" style="display: flex; flex-wrap: wrap; gap: 8px; margin-top: 10px;"></div>
            </div>
        </div>
        <div id="tab-progression" class="tab-content">
            <h2 style="color: #51cf66; margin-bottom: 15px;">üìà Suivi Semaine</h2>
            <div id="historique-semaine"></div>
        </div>
        <div id="tab-grignotages" class="tab-content">
            <h2 style="color: #51cf66; margin-bottom: 15px;">üç™ Grignotages</h2>
            <button class="btn btn-primary" style="width: 100%; margin-bottom: 15px;" onclick="openGrignotageModal()">+ Ajouter grignotage</button>
            <div class="grignotage-section" id="liste-grignotages"><p style="color: #999; text-align: center;">Aucun grignotage aujourd'hui üëç</p></div>
            <div class="progress-card"><h3>Total grignotages : <span id="total-grignotages" style="color: #ffc107;">+0 kcal</span></h3></div>
        </div>
        <div id="tab-export" class="tab-content">
            <h2 style="color: #51cf66; margin-bottom: 15px;">üì§ Export Donn√©es</h2>
            <button class="btn btn-primary" style="width: 100%; margin: 10px 0;" onclick="exportRapport()">üìã Copier rapport complet</button>
            <button class="btn btn-secondary" style="width: 100%;" onclick="resetJour()">üîÑ Reset aujourd'hui</button>
        </div>
    </div>
    <div class="modal" id="modal-grignotage">
        <div class="modal-content">
            <div class="modal-header">üç™ Ajouter grignotage</div>
            <div class="modal-body">
                <input type="text" class="modal-input" id="input-aliment" placeholder="Aliment (ex: Chocolat noir)">
                <input type="number" class="modal-input" id="input-quantite" placeholder="Quantit√© (g)">
                <input type="number" class="modal-input" id="input-calories" placeholder="Calories">
            </div>
            <div style="display: flex; gap: 10px;">
                <button class="btn btn-secondary" style="flex: 1;" onclick="closeModal()">Annuler</button>
                <button class="btn btn-primary" style="flex: 1;" onclick="ajouterGrignotage()">Ajouter</button>
            </div>
        </div>
    </div>
    <script>const SAISONS={automne:{mois:[9,10,11],nom:'Automne',emoji:'üçÇ',fruits:['Pomme','Poire','Raisin','Figue','Coing'],legumes:['Courge butternut','Potimarron','Brocoli','Chou-fleur','Champignons','Poireaux','√âpinards','Haricots verts','Betterave','Carotte']},hiver:{mois:[12,1,2],nom:'Hiver',emoji:'‚ùÑÔ∏è',fruits:['Pomme','Poire','Orange','Cl√©mentine','Kiwi','Mandarine'],legumes:['Poireaux','Chou','√âpinards','Carotte','C√©leri','Endive','M√¢che','Courge','Topinambour','Panais']},printemps:{mois:[3,4,5],nom:'Printemps',emoji:'üå∏',fruits:['Fraise','Cerise','Pomme','Rhubarbe'],legumes:['Asperge','Petits pois','F√®ve','Radis','√âpinards','Laitue','Artichaut','Carotte nouvelle','Navet']},ete:{mois:[6,7,8],nom:'√ât√©',emoji:'‚òÄÔ∏è',fruits:['P√™che','Abricot','Melon','Past√®que','Cerise','Framboise','Myrtille','Prune'],legumes:['Tomate','Courgette','Aubergine','Poivron','Haricots verts','Concombre','Fenouil','Ma√Øs']}};function getSaison(){const mois=new Date().getMonth()+1;for(const[key,saison]of Object.entries(SAISONS)){if(saison.mois.includes(mois))return saison}return SAISONS.automne}let SAISON_ACTUELLE=getSaison();const MENUS_TEMPLATE={training:{calories:2480,macros:{P:208,G:264,L:90},repas:[{id:'petit_dej',nom:'Petit-d√©jeuner',heure:'08:00',calories:520,macros:{P:52,G:48,L:22},aliments:['Flocons avoine complet : 40g','Whey isolate : 30g','≈íufs : 2 entiers + 3 blancs (r√©duit cholest√©rol)','Lait d\'avoine : 200ml (fibres Œ≤-glucane)','[FRUIT1] : 1 moyen','Graines lin moulues : 10g (om√©ga-3)','Cannelle : 1 c.caf√© (glyc√©mie)'],supplements:['D3 5000 UI','Om√©ga-3 4g','Magn√©sium 300mg','Zinc 15mg','Berb√©rine 500mg (glyc√©mie)']},{id:'collation_matin',nom:'Collation',heure:'10:30',calories:180,macros:{P:6,G:24,L:10},aliments:['Noix non sal√©es : 20g (om√©ga-3)','Galettes riz complet : 2','[FRUIT2] : 1 petit','Th√© vert matcha']},{id:'pre_training',nom:'Pr√©-Training',heure:'12:15',calories:280,macros:{P:22,G:50,L:5},aliments:['Riz basmati semi-complet : 100g cuit (IG bas)','Blanc dinde : 70g (maigre)','[LEGUME1] : 100g vapeur','Huile olive : 5ml','Cannelle : 1 pinc√©e'],note:'‚ö†Ô∏è CRITIQUE : 75 min avant training'},{id:'intra_training',nom:'Intra-Training (optionnel)',heure:'13:30',calories:60,macros:{P:0,G:15,L:0},aliments:['Eau : 750ml','Sel : 1/2 c.caf√©','Dextrose : 15g (si s√©ance intense >75min)'],note:'Optionnel selon intensit√©'},{id:'post_training',nom:'Post-Training',heure:'14:50',calories:320,macros:{P:34,G:60,L:1},aliments:['Whey isolate : 40g','[FRUIT3] tr√®s m√ªr : 1 grand','Miel acacia : 15g (IG moyen)','Glutamine : 5g','Cannelle : 1 c.caf√© (anti-pic)'],note:'‚ö†Ô∏è IMM√âDIAT vestiaire avant de partir'},{id:'collation_aprem',nom:'Collation',heure:'16:30',calories:240,macros:{P:20,G:14,L:14},aliments:['Skyr 0% : 150g','Beurre cacahu√®te 100% : 20g','Chocolat noir 85% : 10g (polyph√©nols)','Graines chia : 5g (fibres)']},{id:'diner',nom:'D√Æner',heure:'19:00',calories:560,macros:{P:48,G:50,L:26},aliments:['Saumon/Maquereau : 180g (om√©ga-3++)','Patate douce : 120g (IG bas)','[LEGUME2] + [LEGUME3] : 200g vapeur','[LEGUME4] : 100g','Huile colza : 15ml (om√©ga-3)','Ail + curcuma (anti-inflammatoire)']},{id:'marche',nom:'Marche digestive',heure:'19:45',type:'activite',duree:'20 min',note:'‚ö†Ô∏è OBLIGATOIRE : R√©duit gaz 50% + glyc√©mie -30%'},{id:'avant_coucher',nom:'Avant coucher',heure:'22:30',calories:280,macros:{P:26,G:18,L:12},aliments:['Skyr 0% : 200g','Beurre cacahu√®te : 15g','Miel thym : 5g','Cannelle : 1 pinc√©e'],supplements:['Magn√©sium 400mg','Ashwagandha 600mg','Glycine 3g','Vitamine C 1000mg','Berb√©rine 500mg','Probiotiques 50B UFC']}]},repos:{calories:2200,macros:{P:204,G:168,L:92},repas:[{id:'petit_dej',nom:'Petit-d√©jeuner',heure:'08:00',calories:520,macros:{P:52,G:48,L:22},aliments:['Flocons avoine complet : 40g','Whey isolate : 30g','≈íufs : 2 entiers + 3 blancs','Lait d\'avoine : 200ml','[FRUIT1] : 1 moyen','Graines lin moulues : 10g','Cannelle : 1 c.caf√©'],supplements:['D3 5000 UI','Om√©ga-3 4g','Magn√©sium 300mg','Zinc 15mg','Berb√©rine 500mg']},{id:'collation_matin',nom:'Collation',heure:'11:00',calories:200,macros:{P:14,G:22,L:11},aliments:['Noix de Grenoble : 25g (om√©ga-3)','Galettes riz complet : 2','Fromage blanc 0% : 100g','Th√© vert']},{id:'dejeuner',nom:'D√©jeuner',heure:'13:00',calories:580,macros:{P:52,G:58,L:24},aliments:['Blanc poulet : 200g','Quinoa : 80g cru (prot√©ines v√©g√©tales)','[LEGUME5] + [LEGUME6] : 250g vapeur','Huile olive : 15ml','Citron + herbes fra√Æches']},{id:'collation_aprem',nom:'Collation',heure:'16:00',calories:220,macros:{P:22,G:6,L:16},aliments:['≈íufs durs : 2 entiers + 2 blancs','Noix : 15g','[LEGUME7] : 100g','Concombre : 100g']},{id:'diner',nom:'D√Æner',heure:'19:00',calories:400,macros:{P:42,G:32,L:16},aliments:['Cabillaud/Colin : 200g (poisson blanc)','[LEGUME1] r√¥ti : 150g','[LEGUME8] : 150g (fibres)','Huile colza : 10ml','Persil + ail']},{id:'marche',nom:'Marche digestive',heure:'19:45',type:'activite',duree:'20 min',note:'Am√©liore sensibilit√© insuline'},{id:'avant_coucher',nom:'Avant coucher',heure:'22:30',calories:280,macros:{P:26,G:18,L:12},aliments:['Skyr 0% : 200g','Beurre cacahu√®te : 15g','Miel thym : 5g','Cannelle'],supplements:['Magn√©sium 400mg','Ashwagandha 600mg','Glycine 3g','Berb√©rine 500mg','Probiotiques 50B']}]}};function genererMenus(){const menus=JSON.parse(JSON.stringify(MENUS_TEMPLATE));const fruits=SAISON_ACTUELLE.fruits;const legumes=SAISON_ACTUELLE.legumes;const mappingFruits={'[FRUIT1]':fruits[0]||'Pomme','[FRUIT2]':fruits[1]||'Poire','[FRUIT3]':fruits[1]||'Poire'};const mappingLegumes={'[LEGUME1]':legumes[0]||'Courge','[LEGUME2]':legumes[1]||'Brocoli','[LEGUME3]':legumes[2]||'Chou-fleur','[LEGUME4]':legumes[3]||'Champignons','[LEGUME5]':legumes[4]||'Poireaux','[LEGUME6]':legumes[5]||'√âpinards','[LEGUME7]':legumes[8]||'Tomate','[LEGUME8]':legumes[6]||'Haricots verts'};for(const type of['training','repos']){menus[type].repas.forEach(repas=>{if(repas.aliments){repas.aliments=repas.aliments.map(aliment=>{let result=aliment;Object.entries({...mappingFruits,...mappingLegumes}).forEach(([key,value])=>{if(result.includes(key)){result=result.replace(key,value+' <span class="season-tag">'+SAISON_ACTUELLE.emoji+'</span>')}});return result})}})}return menus}let MENUS=genererMenus();let jourType='training',grignotages=[],autoSaveTimeout=null;window.onload=function(){updateSeasonDisplay();loadDayType();afficherMenu();loadGrignotages();calculerProgression();loadHistorique();afficherSaison()};function updateSeasonDisplay(){SAISON_ACTUELLE=getSaison();MENUS=genererMenus();document.getElementById('season-badge').textContent=SAISON_ACTUELLE.emoji+' '+SAISON_ACTUELLE.nom.toUpperCase();document.getElementById('season-name-detail').textContent=SAISON_ACTUELLE.nom}function afficherSaison(){const fruitsHTML=SAISON_ACTUELLE.fruits.map(f=>`<span style="background: #fff9e6; padding: 8px 12px; border-radius: 8px; font-size: 13px; font-weight: bold;">üçé ${f}</span>`).join('');const legumesHTML=SAISON_ACTUELLE.legumes.map(l=>`<span style="background: #e8f5e9; padding: 8px 12px; border-radius: 8px; font-size: 13px; font-weight: bold;">ü•¶ ${l}</span>`).join('');document.getElementById('fruits-saison').innerHTML=fruitsHTML;document.getElementById('legumes-saison').innerHTML=legumesHTML}function setDayType(type){jourType=type;localStorage.setItem('jourType',type);document.getElementById('day-display').textContent=type==='training'?'üèãÔ∏è JOUR TRAINING':'üí§ JOUR REPOS';afficherMenu();calculerProgression();showAutoSave()}function loadDayType(){const saved=localStorage.getItem('jourType');if(saved)jourType=saved;document.getElementById('day-display').textContent=jourType==='training'?'üèãÔ∏è JOUR TRAINING':'üí§ JOUR REPOS'}function afficherMenu(){const menu=MENUS[jourType];document.getElementById('cal-total').textContent=menu.calories;document.getElementById('prot-total').textContent=menu.macros.P;document.getElementById('gluc-total').textContent=menu.macros.G;document.getElementById('lip-total').textContent=menu.macros.L;let html='';menu.repas.forEach(repas=>{const valide=isRepasValide(repas.id);if(repas.type==='activite'){html+=`<div class="nutrition-section"><h3>${repas.heure} - ${repas.nom}</h3><div class="meal"><div style="background: #fff9e6; padding: 10px; border-radius: 8px; margin-bottom: 10px;"><strong>‚è±Ô∏è ${repas.duree}</strong></div>${repas.note?`<div style="background: #ffebee; padding: 8px; border-radius: 6px; margin-top: 8px; font-size: 12px;"><strong>‚ö†Ô∏è</strong> ${repas.note}</div>`:''}  <div class="validation-checkbox ${valide?'validated':''}" onclick="toggleRepas('${repas.id}')"><input type="checkbox" ${valide?'checked':''} onclick="event.stopPropagation()"><span><strong>${valide?'‚úÖ Fait':'‚è∏Ô∏è √Ä faire'}</strong></span></div></div></div>`;return}html+=`<div class="nutrition-section"><h3>${repas.heure} - ${repas.nom}</h3><div class="meal"><div class="meal-details"><div class="detail-item"><span class="detail-label">Cal:</span> ${repas.calories}</div><div class="detail-item"><span class="detail-label">P:</span> ${repas.macros.P}g</div><div class="detail-item"><span class="detail-label">G:</span> ${repas.macros.G}g</div><div class="detail-item"><span class="detail-label">L:</span> ${repas.macros.L}g</div></div><div class="meal-foods"><strong>ü•ò Aliments:</strong><ul>${repas.aliments.map(a=>`<li>${a}</li>`).join('')}</ul></div>`;if(repas.supplements)html+=`<div class="meal-foods"><strong>üíä Suppl√©ments:</strong><ul>${repas.supplements.map(s=>`<li>${s}</li>`).join('')}</ul></div>`;if(repas.note)html+=`<div style="background: #fff9e6; padding: 8px; border-radius: 6px; margin-top: 8px; font-size: 12px;"><strong>‚ö†Ô∏è</strong> ${repas.note}</div>`;html+=`<div class="validation-checkbox ${valide?'validated':''}" onclick="toggleRepas('${repas.id}')"><input type="checkbox" ${valide?'checked':''} onclick="event.stopPropagation()"><span><strong>${valide?'‚úÖ Valid√©':'‚è∏Ô∏è √Ä valider'}</strong></span></div></div></div>`});document.getElementById('menu-container').innerHTML=html}function toggleRepas(repasId){const today=new Date().toISOString().split('T')[0];const key=`repas-${today}`;let validations=JSON.parse(localStorage.getItem(key)||'[]');const index=validations.indexOf(repasId);if(index>-1)validations.splice(index,1);else validations.push(repasId);localStorage.setItem(key,JSON.stringify(validations));afficherMenu();calculerProgression();showAutoSave()}function isRepasValide(repasId){const today=new Date().toISOString().split('T')[0];const key=`repas-${today}`;const validations=JSON.parse(localStorage.getItem(key)||'[]');return validations.includes(repasId)}function calculerProgression(){const menu=MENUS[jourType];const today=new Date().toISOString().split('T')[0];const key=`repas-${today}`;const validations=JSON.parse(localStorage.getItem(key)||'[]');let totalCal=0,totalP=0,totalG=0,totalL=0;validations.forEach(id=>{const repas=menu.repas.find(r=>r.id===id);if(repas&&repas.calories){totalCal+=repas.calories;totalP+=repas.macros.P;totalG+=repas.macros.G;totalL+=repas.macros.L}});const grigJour=grignotages.filter(g=>g.date===today);const totalGrig=grigJour.reduce((sum,g)=>sum+g.calories,0);totalCal+=totalGrig;document.getElementById('cal-actuel').textContent=totalCal;document.getElementById('prot-actuel').textContent=totalP;document.getElementById('gluc-actuel').textContent=totalG;document.getElementById('lip-actuel').textContent=totalL;const pct=Math.min(100,Math.round((totalCal/menu.calories)*100));document.getElementById('progress-bar').style.width=pct+'%';document.getElementById('progress-bar').textContent=pct+'%'}function openGrignotageModal(){document.getElementById('modal-grignotage').classList.add('show')}function closeModal(){document.getElementById('modal-grignotage').classList.remove('show')}function ajouterGrignotage(){const aliment=document.getElementById('input-aliment').value.trim();const quantite=document.getElementById('input-quantite').value;const calories=document.getElementById('input-calories').value;if(!aliment||!quantite||!calories){alert('‚ö†Ô∏è Remplis tous les champs');return}const grig={id:Date.now(),date:new Date().toISOString().split('T')[0],heure:new Date().toLocaleTimeString('fr-FR',{hour:'2-digit',minute:'2-digit'}),aliment:aliment,quantite:parseInt(quantite),calories:parseInt(calories)};grignotages.push(grig);localStorage.setItem('grignotages',JSON.stringify(grignotages));document.getElementById('input-aliment').value='';document.getElementById('input-quantite').value='';document.getElementById('input-calories').value='';closeModal();loadGrignotages();calculerProgression();showAutoSave()}function loadGrignotages(){grignotages=JSON.parse(localStorage.getItem('grignotages')||'[]');const today=new Date().toISOString().split('T')[0];const grigJour=grignotages.filter(g=>g.date===today);if(grigJour.length===0){document.getElementById('liste-grignotages').innerHTML='<p style="color: #999; text-align: center;">Aucun grignotage aujourd\'hui üëç</p>';document.getElementById('total-grignotages').textContent='+0 kcal';return}let html='';grigJour.forEach(g=>{html+=`<div class="grignotage-item"><div><strong>${g.heure} - ${g.aliment}</strong><br><small>${g.quantite}g ‚Ä¢ ${g.calories} kcal</small></div><button class="btn btn-danger" onclick="supprimerGrignotage(${g.id})">√ó</button></div>`});document.getElementById('liste-grignotages').innerHTML=html;const total=grigJour.reduce((sum,g)=>sum+g.calories,0);const color=total>500?'#ff6b6b':total>300?'#ffc107':'#51cf66';document.getElementById('total-grignotages').innerHTML=`<span style="color: ${color}">+${total} kcal</span>`}function supprimerGrignotage(id){if(!confirm('Supprimer ce grignotage ?'))return;grignotages=grignotages.filter(g=>g.id!==id);localStorage.setItem('grignotages',JSON.stringify(grignotages));loadGrignotages();calculerProgression();showAutoSave()}function loadHistorique(){const hist=[];for(let i=0;i<7;i++){const date=new Date();date.setDate(date.getDate()-i);const dateStr=date.toISOString().split('T')[0];const key=`repas-${dateStr}`;const validations=JSON.parse(localStorage.getItem(key)||'[]');if(validations.length>0){hist.push({date:dateStr,count:validations.length})}}if(hist.length===0){document.getElementById('historique-semaine').innerHTML='<p style="color: #999;">Aucune donn√©e cette semaine</p>';return}let html='<div class="progress-card"><h3>Derniers 7 jours</h3>';hist.forEach(h=>{const d=new Date(h.date);const nom=d.toLocaleDateString('fr-FR',{weekday:'long',day:'numeric'});html+=`<div style="background: #f0f0f0; padding: 10px; margin: 8px 0; border-radius: 8px;"><strong>${nom}</strong> - ${h.count} repas valid√©s</div>`});html+='</div>';document.getElementById('historique-semaine').innerHTML=html}function exportRapport(){const menu=MENUS[jourType];const today=new Date().toISOString().split('T')[0];const key=`repas-${today}`;const validations=JSON.parse(localStorage.getItem(key)||'[]');const grigJour=grignotages.filter(g=>g.date===today);let totalCal=0,totalP=0,totalG=0,totalL=0;validations.forEach(id=>{const repas=menu.repas.find(r=>r.id===id);if(repas&&repas.calories){totalCal+=repas.calories;totalP+=repas.macros.P;totalG+=repas.macros.G;totalL+=repas.macros.L}});const totalGrig=grigJour.reduce((sum,g)=>sum+g.calories,0);totalCal+=totalGrig;let rapport=`üìä RAPPORT NUTRITION - ${today}\n${jourType==='training'?'üèãÔ∏è JOUR TRAINING':'üí§ JOUR REPOS'}\n${SAISON_ACTUELLE.emoji} Saison: ${SAISON_ACTUELLE.nom}\n\nüéØ OBJECTIFS\nCalories: ${menu.calories} kcal\nProt√©ines: ${menu.macros.P}g | Glucides: ${menu.macros.G}g | Lipides: ${menu.macros.L}g\n\n‚úÖ R√âALISATIONS\nCalories: ${totalCal} kcal (${Math.round((totalCal/menu.calories)*100)}%)\nProt√©ines: ${totalP}g | Glucides: ${totalG}g | Lipides: ${totalL}g\n\nüìã REPAS VALID√âS (${validations.length}/${menu.repas.filter(r=>r.calories||r.type==='activite').length})\n`;validations.forEach(id=>{const repas=menu.repas.find(r=>r.id===id);if(repas)rapport+=repas.type==='activite'?`‚úÖ ${repas.heure} - ${repas.nom} (${repas.duree})\n`:`‚úÖ ${repas.heure} - ${repas.nom} (${repas.calories} kcal)\n`});rapport+=`\nüç™ GRIGNOTAGES\n`;if(grigJour.length>0){grigJour.forEach(g=>rapport+=`${g.heure} - ${g.aliment} ${g.quantite}g (+${g.calories} kcal)\n`);rapport+=`Total: +${totalGrig} kcal\n`}else rapport+=`Aucun grignotage üëç\n`;rapport+=`\nüìù NOTES\n${document.getElementById('notes-jour')?.value||'(Aucune note)'}\n\nüìà ADH√âRENCE: ${Math.round((validations.length/menu.repas.filter(r=>r.calories||r.type==='activite').length)*100)}%\n\n${SAISON_ACTUELLE.emoji} PRODUITS DE SAISON UTILIS√âS\nüçé Fruits: ${SAISON_ACTUELLE.fruits.join(', ')}\nü•¶ L√©gumes: ${SAISON_ACTUELLE.legumes.join(', ')}\n`;navigator.clipboard.writeText(rapport).then(()=>alert('‚úÖ Rapport copi√© dans le presse-papier !')).catch(()=>alert('‚ùå Erreur de copie'))}function resetJour(){if(!confirm('‚ö†Ô∏è R√©initialiser toutes les donn√©es d\'aujourd\'hui ?'))return;const today=new Date().toISOString().split('T')[0];localStorage.removeItem(`repas-${today}`);grignotages=grignotages.filter(g=>g.date!==today);localStorage.setItem('grignotages',JSON.stringify(grignotages));afficherMenu();loadGrignotages();calculerProgression();alert('‚úÖ Journ√©e r√©initialis√©e')}function showAutoSave(){const indicator=document.getElementById('auto-save-indicator');indicator.classList.add('show');setTimeout(()=>indicator.classList.remove('show'),2000)}function showTab(tabName){document.querySelectorAll('.tab-content').forEach(c=>c.classList.remove('active'));document.querySelectorAll('.tab').forEach(t=>t.classList.remove('active'));document.getElementById('tab-'+tabName).classList.add('active');event.target.classList.add('active');if(tabName==='progression')loadHistorique();if(tabName==='saison')afficherSaison()}</script>
</body>
</html></parameter>
</invoke>
