nutrition-tracker.html
<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Nutri-Track Lite - Hocine</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
        }
        .fade-in {
            animation: fadeIn 0.3s ease-in;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .modal-overlay {
            backdrop-filter: blur(4px);
        }
        .checked-row {
            opacity: 0.6;
            background: #f0fdf4;
        }
        .progress-bar {
            transition: width 0.5s ease;
        }
    </style>
</head>
<body class="bg-gray-50 min-h-screen">

    <!-- Container principal -->
    <div class="max-w-4xl mx-auto p-4 pb-24">
        
        <!-- Header -->
        <div class="bg-gradient-to-r from-blue-600 to-blue-700 rounded-xl p-6 text-white shadow-lg mb-6">
            <div class="flex justify-between items-center">
                <div>
                    <h1 class="text-3xl font-bold" id="dateDisplay"></h1>
                    <p class="text-blue-100 mt-1" id="jourType"></p>
                </div>
                <div class="text-right">
                    <div class="text-4xl font-bold" id="heureDisplay"></div>
                </div>
            </div>
        </div>

        <!-- S√©lecteur Type Jour -->
        <div class="bg-white rounded-xl shadow-md p-4 mb-6">
            <label class="block text-sm font-semibold text-gray-700 mb-2">Type de journ√©e :</label>
            <div class="flex gap-3">
                <button onclick="changerTypeJour('training')" id="btnTraining" 
                    class="flex-1 py-3 rounded-lg font-semibold transition">
                    üèãÔ∏è TRAINING
                </button>
                <button onclick="changerTypeJour('repos')" id="btnRepos"
                    class="flex-1 py-3 rounded-lg font-semibold transition">
                    üí§ REPOS
                </button>
            </div>
        </div>

        <!-- Progression -->
        <div class="bg-white rounded-xl shadow-lg p-6 mb-6">
            <h2 class="text-xl font-bold mb-4 text-gray-800">üìä Progression du jour</h2>
            
            <div class="mb-4">
                <div class="flex justify-between text-sm text-gray-600 mb-2">
                    <span>Progression</span>
                    <span class="font-bold" id="pourcentageProgress">0%</span>
                </div>
                <div class="w-full bg-gray-200 rounded-full h-4">
                    <div id="progressBar" class="progress-bar bg-gradient-to-r from-green-400 to-green-600 h-4 rounded-full" style="width: 0%"></div>
                </div>
            </div>

            <div class="grid grid-cols-2 gap-4">
                <div class="bg-gray-50 rounded-lg p-4">
                    <div class="text-xs text-gray-600">Calories</div>
                    <div class="text-2xl font-bold text-gray-900">
                        <span id="caloriesActuel">0</span>
                        <span class="text-sm font-normal text-gray-500">/<span id="caloriesTotal">2480</span></span>
                    </div>
                </div>

                <div class="bg-blue-50 rounded-lg p-4">
                    <div class="text-xs text-blue-700">Prot√©ines</div>
                    <div class="text-2xl font-bold text-blue-900">
                        <span id="proteinesActuel">0</span>
                        <span class="text-sm font-normal text-blue-600">/<span id="proteinesTotal">208</span>g</span>
                    </div>
                </div>

                <div class="bg-amber-50 rounded-lg p-4">
                    <div class="text-xs text-amber-700">Glucides</div>
                    <div class="text-2xl font-bold text-amber-900">
                        <span id="glucidesActuel">0</span>
                        <span class="text-sm font-normal text-amber-600">/<span id="glucidesTotal">264</span>g</span>
                    </div>
                </div>

                <div class="bg-green-50 rounded-lg p-4">
                    <div class="text-xs text-green-700">Lipides</div>
                    <div class="text-2xl font-bold text-green-900">
                        <span id="lipidesActuel">0</span>
                        <span class="text-sm font-normal text-green-600">/<span id="lipidesTotal">90</span>g</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Liste Repas -->
        <div class="bg-white rounded-xl shadow-lg p-6 mb-6">
            <h2 class="text-xl font-bold mb-4 text-gray-800">üçΩÔ∏è Repas du jour</h2>
            <div id="listeRepas" class="space-y-3">
                <!-- G√©n√©r√© par JS -->
            </div>
        </div>

        <!-- Grignotages -->
        <div class="bg-white rounded-xl shadow-lg p-6 mb-6">
            <div class="flex justify-between items-center mb-4">
                <h2 class="text-xl font-bold text-gray-800">üç™ Grignotages</h2>
                <button onclick="ouvrirModalGrignotage()" 
                    class="bg-amber-500 hover:bg-amber-600 text-white px-4 py-2 rounded-lg font-semibold transition">
                    + Ajouter
                </button>
            </div>
            <div id="listeGrignotages" class="space-y-2">
                <p class="text-gray-500 text-sm" id="aucunGrignotage">Aucun grignotage aujourd'hui üëç</p>
            </div>
            <div class="mt-4 pt-4 border-t border-gray-200">
                <div class="flex justify-between items-center">
                    <span class="font-semibold text-gray-700">Total grignotages :</span>
                    <span class="text-xl font-bold" id="totalGrignotages">+0 kcal</span>
                </div>
            </div>
        </div>

        <!-- Actions -->
        <div class="bg-white rounded-xl shadow-lg p-6 mb-6">
            <div class="grid grid-cols-2 gap-4">
                <button onclick="voirSemaine()" 
                    class="bg-purple-600 hover:bg-purple-700 text-white py-3 rounded-lg font-semibold transition">
                    üìä Voir semaine
                </button>
                <button onclick="exporterDonnees()" 
                    class="bg-green-600 hover:bg-green-700 text-white py-3 rounded-lg font-semibold transition">
                    üì§ Exporter
                </button>
                <button onclick="resetJour()" 
                    class="bg-red-500 hover:bg-red-600 text-white py-3 rounded-lg font-semibold transition col-span-2">
                    üîÑ Reset aujourd'hui
                </button>
            </div>
        </div>

    </div>

    <!-- Modal D√©tail Repas -->
    <div id="modalRepas" class="hidden fixed inset-0 bg-black bg-opacity-50 modal-overlay z-50 flex items-center justify-center p-4">
        <div class="bg-white rounded-2xl max-w-2xl w-full max-h-[90vh] overflow-y-auto shadow-2xl fade-in">
            <div class="sticky top-0 bg-white border-b border-gray-200 p-6">
                <div class="flex justify-between items-center">
                    <h3 class="text-2xl font-bold text-gray-900" id="modalTitre"></h3>
                    <button onclick="fermerModal('modalRepas')" class="text-gray-500 hover:text-gray-700 text-3xl">√ó</button>
                </div>
            </div>
            <div class="p-6">
                <div id="modalContenu"></div>
            </div>
        </div>
    </div>

    <!-- Modal Grignotage -->
    <div id="modalGrignotage" class="hidden fixed inset-0 bg-black bg-opacity-50 modal-overlay z-50 flex items-center justify-center p-4">
        <div class="bg-white rounded-2xl max-w-md w-full shadow-2xl fade-in">
            <div class="bg-gradient-to-r from-amber-500 to-amber-600 p-6 rounded-t-2xl">
                <h3 class="text-2xl font-bold text-white">üç™ Ajouter grignotage</h3>
            </div>
            <div class="p-6">
                <div class="space-y-4">
                    <div>
                        <label class="block text-sm font-semibold text-gray-700 mb-2">Aliment</label>
                        <input type="text" id="grignotageAliment" 
                            class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-amber-500 focus:border-transparent"
                            placeholder="Ex: Chocolat noir">
                    </div>
                    <div>
                        <label class="block text-sm font-semibold text-gray-700 mb-2">Quantit√© (g)</label>
                        <input type="number" id="grignotageQuantite" 
                            class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-amber-500 focus:border-transparent"
                            placeholder="30">
                    </div>
                    <div>
                        <label class="block text-sm font-semibold text-gray-700 mb-2">Calories</label>
                        <input type="number" id="grignotageCalories" 
                            class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-amber-500 focus:border-transparent"
                            placeholder="165">
                    </div>
                    <div class="pt-4 flex gap-3">
                        <button onclick="fermerModal('modalGrignotage')" 
                            class="flex-1 bg-gray-200 hover:bg-gray-300 text-gray-800 py-3 rounded-lg font-semibold transition">
                            Annuler
                        </button>
                        <button onclick="ajouterGrignotage()" 
                            class="flex-1 bg-amber-500 hover:bg-amber-600 text-white py-3 rounded-lg font-semibold transition">
                            Ajouter ‚úì
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal Semaine -->
    <div id="modalSemaine" class="hidden fixed inset-0 bg-black bg-opacity-50 modal-overlay z-50 flex items-center justify-center p-4">
        <div class="bg-white rounded-2xl max-w-4xl w-full max-h-[90vh] overflow-y-auto shadow-2xl fade-in">
            <div class="sticky top-0 bg-white border-b border-gray-200 p-6">
                <div class="flex justify-between items-center">
                    <h3 class="text-2xl font-bold text-gray-900">üìä Ma semaine</h3>
                    <button onclick="fermerModal('modalSemaine')" class="text-gray-500 hover:text-gray-700 text-3xl">√ó</button>
                </div>
            </div>
            <div class="p-6" id="contenuSemaine"></div>
        </div>
    </div>

    <script>
        // ==================== DONN√âES ====================
        
        const MENUS = {
            training: {
                calories: 2480,
                macros: { P: 208, G: 264, L: 90 },
                repas: [
                    {
                        id: 'petit_dej',
                        nom: 'Petit-d√©jeuner',
                        heure: '08:00',
                        calories: 520,
                        macros: { P: 52, G: 48, L: 22 },
                        aliments: [
                            'Flocons avoine : 40g',
                            'Whey isolate : 30g',
                            '≈íufs : 2 entiers + 2 blancs',
                            'Lait noisette : 200ml',
                            'Kiwi : 1 moyen',
                            'Huile lin : 10ml'
                        ],
                        supplements: ['D3 5000 UI', 'Om√©ga-3 4g', 'Magn√©sium 300mg', 'Zinc 15mg', 'Berb√©rine 500mg']
                    },
                    {
                        id: 'collation_matin',
                        nom: 'Collation',
                        heure: '10:30',
                        calories: 180,
                        macros: { P: 6, G: 24, L: 10 },
                        aliments: [
                            'Amandes : 25g',
                            'Galettes riz : 2',
                            'Th√© vert matcha'
                        ]
                    },
                    {
                        id: 'pre_training',
                        nom: 'Pr√©-Training',
                        heure: '12:15',
                        calories: 280,
                        macros: { P: 22, G: 50, L: 5 },
                        aliments: [
                            'Riz basmati blanc cuit : 120g',
                            'Blanc poulet : 60g',
                            'Huile olive : 5ml',
                            'Sel + cannelle'
                        ],
                        note: '‚ö†Ô∏è CRITIQUE : 75 min avant training'
                    },
                    {
                        id: 'intra_training',
                        nom: 'Intra-Training',
                        heure: '13:30',
                        calories: 60,
                        macros: { P: 0, G: 15, L: 0 },
                        aliments: [
                            'Dextrose : 15g',
                            'Sel : 1/2 c. caf√©',
                            'Eau : 750ml'
                        ]
                    },
                    {
                        id: 'post_training',
                        nom: 'Post-Training',
                        heure: '14:50',
                        calories: 320,
                        macros: { P: 34, G: 60, L: 1 },
                        aliments: [
                            'Whey isolate : 40g',
                            'Banane tr√®s m√ªre : 1 grande',
                            'Miel : 20g',
                            'Glutamine : 5g'
                        ],
                        note: '‚ö†Ô∏è IMM√âDIAT vestiaire avant de partir'
                    },
                    {
                        id: 'collation_aprem',
                        nom: 'Collation',
                        heure: '16:30',
                        calories: 240,
                        macros: { P: 20, G: 14, L: 14 },
                        aliments: [
                            'Skyr nature : 150g',
                            'Beurre amande : 20g',
                            'Chocolat noir 90% : 10g'
                        ]
                    },
                    {
                        id: 'diner',
                        nom: 'D√Æner',
                        heure: '19:00',
                        calories: 560,
                        macros: { P: 48, G: 50, L: 26 },
                        aliments: [
                            'Saumon/Poulet/Maquereau : 180-200g',
                            'Patate douce : 150g OU Courge : 200g',
                            'Brocoli + carottes vapeur : 200g',
                            'Huile olive : 15ml',
                            'Avocat : 1/2 (optionnel)'
                        ]
                    },
                    {
                        id: 'marche',
                        nom: 'Marche digestive',
                        heure: '19:45',
                        type: 'activite',
                        duree: '20 min',
                        note: '‚ö†Ô∏è OBLIGATOIRE : R√©duit gaz 50%'
                    },
                    {
                        id: 'avant_coucher',
                        nom: 'Avant coucher',
                        heure: '22:30',
                        calories: 280,
                        macros: { P: 26, G: 18, L: 12 },
                        aliments: [
                            'Skyr : 200g',
                            'Beurre amande : 15g',
                            'Miel thym : 5g'
                        ],
                        supplements: ['Magn√©sium 400mg', 'Ashwagandha 600mg', 'Glycine 3g', 'Vitamine C 1000mg', 'Berb√©rine 500mg', 'Probiotiques 50B UFC']
                    }
                ]
            },
            repos: {
                calories: 2200,
                macros: { P: 204, G: 168, L: 92 },
                repas: [
                    {
                        id: 'petit_dej',
                        nom: 'Petit-d√©jeuner',
                        heure: '08:00',
                        calories: 520,
                        macros: { P: 52, G: 48, L: 22 },
                        aliments: [
                            'Flocons avoine : 40g',
                            'Whey isolate : 30g',
                            '≈íufs : 2 entiers + 2 blancs',
                            'Lait noisette : 200ml',
                            'Kiwi : 1 moyen',
                            'Huile lin : 10ml'
                        ],
                        supplements: ['D3 5000 UI', 'Om√©ga-3 4g', 'Magn√©sium 300mg', 'Zinc 15mg', 'Berb√©rine 500mg']
                    },
                    {
                        id: 'collation_matin',
                        nom: 'Collation',
                        heure: '11:00',
                        calories: 200,
                        macros: { P: 14, G: 22, L: 11 },
                        aliments: [
                            'Amandes : 30g',
                            'Galettes riz : 2',
                            'Fromage blanc 0% : 100g',
                            'Th√© vert'
                        ]
                    },
                    {
                        id: 'dejeuner',
                        nom: 'D√©jeuner',
                        heure: '13:00',
                        calories: 580,
                        macros: { P: 52, G: 58, L: 24 },
                        aliments: [
                            'Poulet/Dinde : 200g',
                            'Riz basmati blanc : 100g cru',
                            'L√©gumes vapeur : 250g',
                            'Huile olive : 20ml',
                            'Avocat : 1/2'
                        ]
                    },
                    {
                        id: 'collation_aprem',
                        nom: 'Collation',
                        heure: '16:00',
                        calories: 220,
                        macros: { P: 22, G: 6, L: 16 },
                        aliments: [
                            '≈íufs durs : 3',
                            'Noix : 15g',
                            'Tomates cerises : 150g'
                        ]
                    },
                    {
                        id: 'diner',
                        nom: 'D√Æner',
                        heure: '19:00',
                        calories: 400,
                        macros: { P: 42, G: 32, L: 16 },
                        aliments: [
                            'Poisson blanc : 180g',
                            'L√©gumes r√¥tis : 300g',
                            'Quinoa : 50g cuit',
                            'Huile olive : 10ml'
                        ]
                    },
                    {
                        id: 'marche',
                        nom: 'Marche digestive',
                        heure: '19:45',
                        type: 'activite',
                        duree: '20 min'
                    },
                    {
                        id: 'avant_coucher',
                        nom: 'Avant coucher',
                        heure: '22:30',
                        calories: 280,
                        macros: { P: 26, G: 18, L: 12 },
                        aliments: [
                            'Skyr : 200g',
                            'Beurre amande : 15g',
                            'Miel thym : 5g'
                        ],
                        supplements: ['Magn√©sium 400mg', 'Ashwagandha 600mg', 'Glycine 3g', 'Vitamine C 1000mg', 'Berb√©rine 500mg', 'Probiotiques 50B UFC']
                    }
                ]
            }
        };

        // ==================== √âTAT ====================
        
        let typeJour = 'training';
        let repasValides = [];
        let grignotages = [];

        // ==================== INITIALISATION ====================
        
        function init() {
            chargerDonnees();
            afficherDateTime();
            setInterval(afficherDateTime, 1000);
            changerTypeJour(typeJour);
            afficherRepas();
            afficherGrignotages();
            calculerProgression();
        }

        function afficherDateTime() {
            const maintenant = new Date();
            const options = { weekday: 'long', day: 'numeric', month: 'long' };
            document.getElementById('dateDisplay').textContent = maintenant.toLocaleDateString('fr-FR', options);
            document.getElementById('heureDisplay').textContent = maintenant.toLocaleTimeString('fr-FR', { hour: '2-digit', minute: '2-digit' });
        }

        function changerTypeJour(type) {
            typeJour = type;
            localStorage.setItem('typeJour', type);
            
            // Mise √† jour UI boutons
            const btnTraining = document.getElementById('btnTraining');
            const btnRepos = document.getElementById('btnRepos');
            
            if (type === 'training') {
                btnTraining.className = 'flex-1 py-3 rounded-lg font-semibold transition bg-blue-600 text-white';
                btnRepos.className = 'flex-1 py-3 rounded-lg font-semibold transition bg-gray-200 text-gray-700';
                document.getElementById('jourType').textContent = 'üèãÔ∏è JOUR TRAINING - 2480 KCAL';
            } else {
                btnTraining.className = 'flex-1 py-3 rounded-lg font-semibold transition bg-gray-200 text-gray-700';
                btnRepos.className = 'flex-1 py-3 rounded-lg font-semibold transition bg-purple-600 text-white';
                document.getElementById('jourType').textContent = 'üí§ JOUR REPOS - 2200 KCAL';
            }
            
            const menu = MENUS[type];
            document.getElementById('caloriesTotal').textContent = menu.calories;
            document.getElementById('proteinesTotal').textContent = menu.macros.P;
            document.getElementById('glucidesTotal').textContent = menu.macros.G;
            document.getElementById('lipidesTotal').textContent = menu.macros.L;
            
            afficherRepas();
            calculerProgression();
        }

        // ==================== REPAS ====================
        
        function afficherRepas() {
            const menu = MENUS[typeJour];
            const html = menu.repas.map(repas => {
                const isValidated = repasValides.includes(repas.id);
                const rowClass = isValidated ? 'checked-row' : '';
                
                if (repas.type === 'activite') {
                    return `
                        <div class="${rowClass} border border-gray-200 rounded-lg p-4 transition">
                            <div class="flex items-center justify-between">
                                <div class="flex items-center gap-3">
                                    <input type="checkbox" ${isValidated ? 'checked' : ''} 
                                        onchange="toggleRepas('${repas.id}')"
                                        class="w-5 h-5 text-blue-600 rounded focus:ring-2">
                                    <div>
                                        <div class="font-semibold text-gray-900">${repas.heure} - ${repas.nom}</div>
                                        <div class="text-sm text-gray-600">${repas.duree}</div>
                                    </div>
                                </div>
                            </div>
                            ${repas.note ? `<div class="mt-2 text-sm text-amber-700 bg-amber-50 p-2 rounded">${repas.note}</div>` : ''}
                        </div>
                    `;
                }
                
                return `
                    <div class="${rowClass} border border-gray-200 rounded-lg p-4 transition hover:shadow-md cursor-pointer"
                         onclick="afficherDetailRepas('${repas.id}')">
                        <div class="flex items-center justify-between">
                            <div class="flex items-center gap-3">
                                <input type="checkbox" ${isValidated ? 'checked' : ''} 
                                    onchange="toggleRepas('${repas.id}')" 
                                    onclick="event.stopPropagation()"
                                    class="w-5 h-5 text-blue-600 rounded focus:ring-2">
                                <div>
                                    <div class="font-semibold text-gray-900">${repas.heure} - ${repas.nom}</div>
                                    <div class="text-sm text-gray-600">
                                        ${repas.calories} kcal ‚Ä¢ P${repas.macros.P} G${repas.macros.G} L${repas.macros.L}
                                    </div>
                                </div>
                            </div>
                            <div class="text-blue-600 font-bold">‚Üí</div>
                        </div>
                        ${repas.note ? `<div class="mt-2 text-sm text-amber-700 bg-amber-50 p-2 rounded">${repas.note}</div>` : ''}
                    </div>
                `;
            }).join('');
            
            document.getElementById('listeRepas').innerHTML = html;
        }

        function toggleRepas(repasId) {
            const index = repasValides.indexOf(repasId);
            if (index > -1) {
                repasValides.splice(index, 1);
            } else {
                repasValides.push(repasId);
            }
            sauvegarderDonnees();
            afficherRepas();
            calculerProgression();
        }

        function afficherDetailRepas(repasId) {
            const menu = MENUS[typeJour];
            const repas = menu.repas.find(r => r.id === repasId);
            
            if (!repas || repas.type === 'activite') return;
            
            let html = `
                <div class="space-y-4">
                    <div class="bg-gradient-to-r from-blue-50 to-blue-100 p-4 rounded-lg">
                        <div class="text-sm text-blue-700 font-semibold">MACROS</div>
                        <div class="text-2xl font-bold text-blue-900">
                            ${repas.calories} kcal
                        </div>
                        <div class="text-sm text-blue-700 mt-1">
                            P ${repas.macros.P}g ‚Ä¢ G ${repas.macros.G}g ‚Ä¢ L ${repas.macros.L}g
                        </div>
                    </div>
                    
                    <div>
                        <h4 class="font-bold text-gray-900 mb-2">ü•ò Aliments</h4>
                        <ul class="space-y-2">
                            ${repas.aliments.map(a => `<li class="flex items-start gap-2 text-gray-700"><span class="text-blue-600">‚Ä¢</span>${a}</li>`).join('')}
                        </ul>
                    </div>
            `;
            
            if (repas.supplements) {
                html += `
                    <div>
                        <h4 class="font-bold text-gray-900 mb-2">üíä Suppl√©ments</h4>
                        <ul class="space-y-2">
                            ${repas.supplements.map(s => `<li class="flex items-start gap-2 text-gray-700"><span class="text-purple-600">‚Ä¢</span>${s}</li>`).join('')}
                        </ul>
                    </div>
                `;
            }
            
            html += '</div>';
            
            document.getElementById('modalTitre').textContent = repas.heure + ' - ' + repas.nom;
            document.getElementById('modalContenu').innerHTML = html;
            document.getElementById('modalRepas').classList.remove('hidden');
}

        // ==================== GRIGNOTAGES ====================
        
        function ouvrirModalGrignotage() {
            document.getElementById('grignotageAliment').value = '';
            document.getElementById('grignotageQuantite').value = '';
            document.getElementById('grignotageCalories').value = '';
            document.getElementById('modalGrignotage').classList.remove('hidden');
        }

        function ajouterGrignotage() {
            const aliment = document.getElementById('grignotageAliment').value.trim();
            const quantite = document.getElementById('grignotageQuantite').value;
            const calories = document.getElementById('grignotageCalories').value;
            
            if (!aliment || !quantite || !calories) {
                alert('‚ö†Ô∏è Remplis tous les champs');
                return;
            }
            
            const grignotage = {
                id: Date.now(),
                date: new Date().toISOString().split('T')[0],
                heure: new Date().toLocaleTimeString('fr-FR', { hour: '2-digit', minute: '2-digit' }),
                aliment: aliment,
                quantite: parseInt(quantite),
                calories: parseInt(calories)
            };
            
            grignotages.push(grignotage);
            sauvegarderDonnees();
            afficherGrignotages();
            calculerProgression();
            fermerModal('modalGrignotage');
        }

        function afficherGrignotages() {
            const aujourdhui = new Date().toISOString().split('T')[0];
            const grignotagesJour = grignotages.filter(g => g.date === aujourdhui);
            
            if (grignotagesJour.length === 0) {
                document.getElementById('aucunGrignotage').classList.remove('hidden');
                document.getElementById('listeGrignotages').innerHTML = '<p class="text-gray-500 text-sm">Aucun grignotage aujourd\'hui üëç</p>';
                document.getElementById('totalGrignotages').textContent = '+0 kcal';
                return;
            }
            
            document.getElementById('aucunGrignotage').classList.add('hidden');
            
            const total = grignotagesJour.reduce((sum, g) => sum + g.calories, 0);
            
            const html = grignotagesJour.map(g => `
                <div class="flex items-center justify-between bg-amber-50 p-3 rounded-lg border border-amber-200">
                    <div>
                        <div class="font-semibold text-gray-900">${g.heure} - ${g.aliment}</div>
                        <div class="text-sm text-gray-600">${g.quantite}g ‚Ä¢ ${g.calories} kcal</div>
                    </div>
                    <button onclick="supprimerGrignotage(${g.id})" 
                        class="text-red-500 hover:text-red-700 text-xl font-bold">√ó</button>
                </div>
            `).join('');
            
            document.getElementById('listeGrignotages').innerHTML = html;
            
            const totalClass = total > 500 ? 'text-red-600' : total > 300 ? 'text-amber-600' : 'text-green-600';
            document.getElementById('totalGrignotages').innerHTML = `<span class="${totalClass}">+${total} kcal</span>`;
        }

        function supprimerGrignotage(id) {
            if (confirm('Supprimer ce grignotage ?')) {
                grignotages = grignotages.filter(g => g.id !== id);
                sauvegarderDonnees();
                afficherGrignotages();
                calculerProgression();
            }
        }

        // ==================== PROGRESSION ====================
        
        function calculerProgression() {
            const menu = MENUS[typeJour];
            const aujourdhui = new Date().toISOString().split('T')[0];
            
            // Calculer repas valid√©s
            let totalCal = 0;
            let totalP = 0;
            let totalG = 0;
            let totalL = 0;
            
            repasValides.forEach(repasId => {
                const repas = menu.repas.find(r => r.id === repasId);
                if (repas && repas.calories) {
                    totalCal += repas.calories;
                    totalP += repas.macros.P;
                    totalG += repas.macros.G;
                    totalL += repas.macros.L;
                }
            });
            
            // Ajouter grignotages
            const grignotagesJour = grignotages.filter(g => g.date === aujourdhui);
            const totalGrignotages = grignotagesJour.reduce((sum, g) => sum + g.calories, 0);
            totalCal += totalGrignotages;
            
            // Afficher
            document.getElementById('caloriesActuel').textContent = totalCal;
            document.getElementById('proteinesActuel').textContent = totalP;
            document.getElementById('glucidesActuel').textContent = totalG;
            document.getElementById('lipidesActuel').textContent = totalL;
            
            // Barre de progression
            const pourcentage = Math.min(100, Math.round((totalCal / menu.calories) * 100));
            document.getElementById('progressBar').style.width = pourcentage + '%';
            document.getElementById('pourcentageProgress').textContent = pourcentage + '%';
            
            // Changer couleur selon d√©passement
            const progressBar = document.getElementById('progressBar');
            if (pourcentage >= 100) {
                progressBar.className = 'progress-bar bg-gradient-to-r from-green-400 to-green-600 h-4 rounded-full';
            } else if (pourcentage >= 80) {
                progressBar.className = 'progress-bar bg-gradient-to-r from-blue-400 to-blue-600 h-4 rounded-full';
            } else {
                progressBar.className = 'progress-bar bg-gradient-to-r from-amber-400 to-amber-600 h-4 rounded-full';
            }
        }

        // ==================== SEMAINE ====================
        
        function voirSemaine() {
            const historique = JSON.parse(localStorage.getItem('historiqueSemaine') || '{}');
            const dates = Object.keys(historique).sort().reverse().slice(0, 7);
            
            if (dates.length === 0) {
                document.getElementById('contenuSemaine').innerHTML = '<p class="text-gray-500 text-center py-8">Aucune donn√©e cette semaine</p>';
                document.getElementById('modalSemaine').classList.remove('hidden');
                return;
            }
            
            let totalCalories = 0;
            let totalGrignotages = 0;
            let joursValides = 0;
            
            const html = dates.map(date => {
                const jour = historique[date];
                const dateObj = new Date(date);
                const nomJour = dateObj.toLocaleDateString('fr-FR', { weekday: 'long', day: 'numeric', month: 'short' });
                
                totalCalories += jour.calories || 0;
                totalGrignotages += jour.grignotages || 0;
                if (jour.adherence >= 80) joursValides++;
                
                const adherenceClass = jour.adherence >= 90 ? 'text-green-600' : jour.adherence >= 70 ? 'text-blue-600' : 'text-amber-600';
                
                return `
                    <div class="border border-gray-200 rounded-lg p-4 hover:shadow-md transition">
                        <div class="flex justify-between items-center mb-2">
                            <div class="font-bold text-gray-900">${nomJour}</div>
                            <div class="text-sm ${jour.type === 'training' ? 'bg-blue-100 text-blue-800' : 'bg-purple-100 text-purple-800'} px-3 py-1 rounded-full font-semibold">
                                ${jour.type === 'training' ? 'üèãÔ∏è Training' : 'üí§ Repos'}
                            </div>
                        </div>
                        <div class="grid grid-cols-3 gap-3 text-sm">
                            <div>
                                <div class="text-gray-600">Calories</div>
                                <div class="font-bold text-gray-900">${jour.calories || 0} kcal</div>
                            </div>
                            <div>
                                <div class="text-gray-600">Grignotages</div>
                                <div class="font-bold ${jour.grignotages > 0 ? 'text-amber-600' : 'text-green-600'}">${jour.grignotages > 0 ? '+' + jour.grignotages : '0'} kcal</div>
                            </div>
                            <div>
                                <div class="text-gray-600">Adh√©rence</div>
                                <div class="font-bold ${adherenceClass}">${jour.adherence || 0}%</div>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
            
            const moyenneCalories = Math.round(totalCalories / dates.length);
            const moyenneGrignotages = Math.round(totalGrignotages / dates.length);
            const tauxReussite = Math.round((joursValides / dates.length) * 100);
            
            const recap = `
                <div class="bg-gradient-to-r from-blue-600 to-purple-600 rounded-xl p-6 text-white mb-6">
                    <h4 class="text-xl font-bold mb-4">üìä R√©capitulatif semaine</h4>
                    <div class="grid grid-cols-3 gap-4 text-center">
                        <div>
                            <div class="text-3xl font-bold">${moyenneCalories}</div>
                            <div class="text-sm text-blue-100">kcal moy/jour</div>
                        </div>
                        <div>
                            <div class="text-3xl font-bold">${moyenneGrignotages}</div>
                            <div class="text-sm text-blue-100">grignotages moy</div>
                        </div>
                        <div>
                            <div class="text-3xl font-bold">${tauxReussite}%</div>
                            <div class="text-sm text-blue-100">adh√©rence</div>
                        </div>
                    </div>
                </div>
                <div class="space-y-3">
                    ${html}
                </div>
            `;
            
            document.getElementById('contenuSemaine').innerHTML = recap;
            document.getElementById('modalSemaine').classList.remove('hidden');
        }

        // ==================== EXPORT ====================
        
        function exporterDonnees() {
            const menu = MENUS[typeJour];
            const aujourdhui = new Date().toISOString().split('T')[0];
            const grignotagesJour = grignotages.filter(g => g.date === aujourdhui);
            
            let totalCal = 0;
            let totalP = 0;
            let totalG = 0;
            let totalL = 0;
            
            const repasDetails = repasValides.map(repasId => {
                const repas = menu.repas.find(r => r.id === repasId);
                if (repas && repas.calories) {
                    totalCal += repas.calories;
                    totalP += repas.macros.P;
                    totalG += repas.macros.G;
                    totalL += repas.macros.L;
                    return `${repas.heure} - ${repas.nom} (${repas.calories} kcal)`;
                }
                return null;
            }).filter(Boolean);
            
            const totalGrignotagesCal = grignotagesJour.reduce((sum, g) => sum + g.calories, 0);
            totalCal += totalGrignotagesCal;
            
            const rapport = {
                date: aujourdhui,
                typeJour: typeJour,
                objectifs: {
                    calories: menu.calories,
                    proteines: menu.macros.P,
                    glucides: menu.macros.G,
                    lipides: menu.macros.L
                },
                realisations: {
                    calories: totalCal,
                    proteines: totalP,
                    glucides: totalG,
                    lipides: totalL
                },
                adherence: Math.round((repasValides.length / menu.repas.filter(r => r.calories).length) * 100),
                repas_valides: repasDetails,
                grignotages: grignotagesJour.map(g => `${g.heure} - ${g.aliment} ${g.quantite}g (+${g.calories} kcal)`),
                total_grignotages: totalGrignotagesCal,
                notes: `Adh√©rence: ${Math.round((repasValides.length / menu.repas.filter(r => r.calories).length) * 100)}% | Surplus grignotages: ${totalGrignotagesCal > 500 ? '‚ö†Ô∏è √âLEV√â' : totalGrignotagesCal > 300 ? '‚ö†Ô∏è MOD√âR√â' : '‚úÖ OK'}`
            };
            
            // Export JSON
            const dataStr = JSON.stringify(rapport, null, 2);
            const dataUri = 'data:application/json;charset=utf-8,' + encodeURIComponent(dataStr);
            const exportFileDefaultName = `nutrition-${aujourdhui}.json`;
            
            const linkElement = document.createElement('a');
            linkElement.setAttribute('href', dataUri);
            linkElement.setAttribute('download', exportFileDefaultName);
            linkElement.click();
            
            // Export texte pour partage
            const texte = `
üìä RAPPORT NUTRITION - ${aujourdhui}
${typeJour === 'training' ? 'üèãÔ∏è JOUR TRAINING' : 'üí§ JOUR REPOS'}

üéØ OBJECTIFS
Calories: ${menu.calories} kcal
Prot√©ines: ${menu.macros.P}g | Glucides: ${menu.macros.G}g | Lipides: ${menu.macros.L}g

‚úÖ R√âALISATIONS
Calories: ${totalCal} kcal (${Math.round((totalCal/menu.calories)*100)}%)
Prot√©ines: ${totalP}g | Glucides: ${totalG}g | Lipides: ${totalL}g

üìã REPAS VALID√âS (${repasValides.length}/${menu.repas.filter(r => r.calories).length})
${repasDetails.join('\n')}

üç™ GRIGNOTAGES
${grignotagesJour.length > 0 ? grignotagesJour.map(g => `${g.heure} - ${g.aliment} ${g.quantite}g (+${g.calories} kcal)`).join('\n') : 'Aucun grignotage üëç'}
Total: +${totalGrignotagesCal} kcal

üìà ADH√âRENCE: ${Math.round((repasValides.length / menu.repas.filter(r => r.calories).length) * 100)}%
            `.trim();
            
            // Copier dans presse-papier
            navigator.clipboard.writeText(texte).then(() => {
                alert('‚úÖ Rapport copi√© dans le presse-papier ET t√©l√©charg√© en JSON !');
            });
        }

        // ==================== RESET ====================
        
        function resetJour() {
            if (confirm('‚ö†Ô∏è R√©initialiser toutes les donn√©es d\'aujourd\'hui ?')) {
                repasValides = [];
                const aujourdhui = new Date().toISOString().split('T')[0];
                grignotages = grignotages.filter(g => g.date !== aujourdhui);
                sauvegarderDonnees();
                afficherRepas();
                afficherGrignotages();
                calculerProgression();
                alert('‚úÖ Journ√©e r√©initialis√©e');
            }
        }

        // ==================== STOCKAGE ====================
        
        function sauvegarderDonnees() {
            const aujourdhui = new Date().toISOString().split('T')[0];
            
            localStorage.setItem('repasValides', JSON.stringify(repasValides));
            localStorage.setItem('grignotages', JSON.stringify(grignotages));
            localStorage.setItem('typeJour', typeJour);
            localStorage.setItem('derniereSauvegarde', aujourdhui);
            
            // Sauvegarder dans historique semaine
            sauvegarderHistoriqueSemaine();
        }

        function chargerDonnees() {
            const aujourdhui = new Date().toISOString().split('T')[0];
            const derniereSauvegarde = localStorage.getItem('derniereSauvegarde');
            
            // Reset automatique si nouveau jour
            if (derniereSauvegarde && derniereSauvegarde !== aujourdhui) {
                repasValides = [];
                localStorage.removeItem('repasValides');
            } else {
                repasValides = JSON.parse(localStorage.getItem('repasValides') || '[]');
            }
            
            grignotages = JSON.parse(localStorage.getItem('grignotages') || '[]');
            typeJour = localStorage.getItem('typeJour') || 'training';
        }

        function sauvegarderHistoriqueSemaine() {
            const aujourdhui = new Date().toISOString().split('T')[0];
            const menu = MENUS[typeJour];
            const grignotagesJour = grignotages.filter(g => g.date === aujourdhui);
            
            let totalCal = 0;
            repasValides.forEach(repasId => {
                const repas = menu.repas.find(r => r.id === repasId);
                if (repas && repas.calories) totalCal += repas.calories;
            });
            
            const totalGrignotagesCal = grignotagesJour.reduce((sum, g) => sum + g.calories, 0);
            
            const historique = JSON.parse(localStorage.getItem('historiqueSemaine') || '{}');
            historique[aujourdhui] = {
                type: typeJour,
                calories: totalCal,
                grignotages: totalGrignotagesCal,
                adherence: Math.round((repasValides.length / menu.repas.filter(r => r.calories).length) * 100)
            };
            
            localStorage.setItem('historiqueSemaine', JSON.stringify(historique));
        }

        // ==================== MODALS ====================
        
        function fermerModal(modalId) {
            document.getElementById(modalId).classList.add('hidden');
        }

        // Fermer modals avec ESC
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape') {
                fermerModal('modalRepas');
                fermerModal('modalGrignotage');
                fermerModal('modalSemaine');
            }
        });

        // ==================== D√âMARRAGE ====================
        
        window.onload = init;
    </script>

</body>
</html>
Ajout Nutri-Track Lite
